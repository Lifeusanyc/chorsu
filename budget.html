<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Real Vaqtli Balans Dashboard</title>

  <!-- Kutubxonalar -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.0"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <style>
    body {
      margin: 0;
      overflow-x: hidden;
    }
    canvas.webgl-bg {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1;
    }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen p-6">
  <canvas class="webgl-bg"></canvas>

  <div class="max-w-5xl mx-auto space-y-6">
    <h1 class="text-4xl font-bold text-center text-blue-400">ğŸŒ Real Vaqtli Balans Dashboard</h1>

    <div class="flex flex-wrap justify-between items-center gap-4">
      <div>
        <label class="text-sm">ğŸ“… Sana tanlang:</label>
        <input id="datePicker" type="date" class="bg-gray-800 p-2 rounded text-white" />
      </div>
      <div>
        <button onclick="exportCSV()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded font-semibold">â¬‡ï¸ CSV eksport</button>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-gray-800 p-6 rounded-2xl space-y-3 shadow-lg">
        <div class="text-xl font-mono">â° Joriy vaqt: <span id="time" class="text-green-400"></span></div>
        <div class="text-2xl">ğŸ’° Balans: <span id="balance" class="text-yellow-400 font-bold"></span></div>
      </div>
      <div class="bg-gray-800 p-4 rounded-2xl shadow-lg">
        <canvas id="balanceChart" height="180"></canvas>
      </div>
    </div>

    <div class="bg-gray-800 p-4 rounded-2xl shadow-lg">
      <h2 class="text-xl mb-2">ğŸ§¾ Soâ€˜nggi balanslar tarixi</h2>
      <ul id="history" class="text-sm font-mono space-y-1 text-gray-300"></ul>
    </div>
  </div>

  <script>
    // Omonatning boshlang'ich parametrlarini belgilash
    let balance = 0;
    const incomeRange = { min: 5000, max: 7000 };
    const expenseRange = { min: 4000, max: 5000 };
    const labels = [], incomeData = [], expenseData = [], balanceData = [];
    const history = [];

    const chart = new Chart(document.getElementById('balanceChart'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [
          {
            label: "Kirim",
            data: incomeData,
            borderColor: "rgb(59, 130, 246)",
            backgroundColor: "rgba(59,130,246,0.1)",
            tension: 0.3
          },
          {
            label: "Chiqim",
            data: expenseData,
            borderColor: "rgb(239, 68, 68)",
            backgroundColor: "rgba(239,68,68,0.1)",
            tension: 0.3
          },
          {
            label: "Balans",
            data: balanceData,
            borderColor: "rgb(34, 197, 94)",
            backgroundColor: "rgba(34,197,94,0.1)",
            tension: 0.3
          }
        ]
      },
      options: {
        plugins: {
          zoom: {
            zoom: { wheel: { enabled: true }, mode: 'x' },
            pan: { enabled: true, mode: 'x' }
          }
        },
        scales: { y: { beginAtZero: true } },
        responsive: true
      }
    });

    function update() {
      // Kirim va chiqimni tasodifiy tanlash
      const income = Math.random() * (incomeRange.max - incomeRange.min) + incomeRange.min;
      const expense = Math.random() * (expenseRange.max - expenseRange.min) + expenseRange.min;
      
      // Balansni hisoblash
      balance += income - expense;

      // Vaqtni koâ€˜rsatish
      const now = new Date();
      document.getElementById('time').textContent = now.toLocaleString();
      document.getElementById('balance').textContent = "$" + balance.toFixed(2);

      // Grafik uchun ma'lumotlar
      const timeLabel = now.toLocaleTimeString();
      labels.push(timeLabel);
      incomeData.push(income);
      expenseData.push(expense);
      balanceData.push(balance);

      // Oxirgi 10 soniyani saqlash
      if (labels.length > 20) {
        labels.shift();
        incomeData.shift();
        expenseData.shift();
        balanceData.shift();
      }

      chart.update();

      // Tarixni yangilash
      history.unshift(`${timeLabel} - Kirim: $${income.toFixed(2)} | Chiqim: $${expense.toFixed(2)} | Balans: $${balance.toFixed(2)}`);
      if (history.length > 10) history.pop();
      document.getElementById("history").innerHTML = history.map(e => `<li>${e}</li>`).join('');
    }

    setInterval(update, 1000);

    function exportCSV() {
      let csv = "Vaqt,Kirim,Chiqim,Balans\n";
      for (let i = 0; i < labels.length; i++) {
        csv += `${labels[i]},${incomeData[i].toFixed(2)},${expenseData[i].toFixed(2)},${balanceData[i].toFixed(2)}\n`;
      }
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      saveAs(blob, "balans_tarixi.csv");
    }

  </script>
</body>
</html>
