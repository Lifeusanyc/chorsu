<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Balans Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-950 text-white min-h-screen p-6">
  <div class="max-w-4xl mx-auto space-y-8">
    <h1 class="text-4xl font-bold text-center text-blue-400">üí∞ Real Vaqt Balans Dashboard</h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div class="bg-gray-900 rounded-2xl p-6 shadow-lg space-y-4">
        <h2 class="text-2xl font-semibold">‚è± Joriy vaqt</h2>
        <p id="time" class="text-xl font-mono text-green-400"></p>

        <h2 class="text-2xl font-semibold">üí∏ Joriy balans</h2>
        <p id="balance" class="text-3xl font-bold text-yellow-300"></p>
      </div>

      <div class="bg-gray-900 rounded-2xl p-6 shadow-lg">
        <h2 class="text-2xl font-semibold mb-2">üìâ Balans o‚Äòsish grafigi</h2>
        <canvas id="balanceChart" height="200"></canvas>
      </div>
    </div>

    <div class="bg-gray-900 rounded-2xl p-6 shadow-lg">
      <h2 class="text-2xl font-semibold mb-4">üìä Oxirgi balanslar tarixi (so‚Äònggi 10 sekund)</h2>
      <ul id="history" class="space-y-1 font-mono text-sm text-gray-300"></ul>
    </div>
  </div>

  <script>
    const startDate = new Date("2023-04-04T00:00:00");
    const date2024 = new Date("2024-01-01T00:00:00");
    const date2025 = new Date("2025-01-01T00:00:00");
    const balance2024 = 15000;
    const balance2025 = 30000;

    const totalDays1 = (date2024 - startDate) / (1000 * 60 * 60 * 24);
    const totalDays2 = (date2025 - date2024) / (1000 * 60 * 60 * 24);

    const dailyGrowth1 = balance2024 / totalDays1;
    const dailyGrowth2 = (balance2025 - balance2024) / totalDays2;

    const balanceHistory = [];
    const labels = [];
    const chartData = {
      labels: labels,
      datasets: [{
        label: 'Balans ($)',
        backgroundColor: 'rgba(34,197,94,0.2)',
        borderColor: 'rgb(34,197,94)',
        data: [],
        tension: 0.3
      }]
    };

    const ctx = document.getElementById('balanceChart').getContext('2d');
    const balanceChart = new Chart(ctx, {
      type: 'line',
      data: chartData,
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    function getCurrentBalance(now) {
      let balance = 0;
      if (now < startDate) {
        balance = 0;
      } else if (now < date2024) {
        const daysPassed = (now - startDate) / (1000 * 60 * 60 * 24);
        balance = daysPassed * dailyGrowth1;
      } else {
        const daysPassed = (now - date2024) / (1000 * 60 * 60 * 24);
        balance = balance2024 + daysPassed * dailyGrowth2;
      }
      return balance;
    }

    function update() {
      const now = new Date();
      const balance = getCurrentBalance(now);

      // UI yangilash
      document.getElementById("time").textContent = now.toLocaleString();
      document.getElementById("balance").textContent = "$" + balance.toFixed(2);

      // Grafik uchun yangilash
      const timeLabel = now.toLocaleTimeString();
      labels.push(timeLabel);
      chartData.datasets[0].data.push(balance);
      if (labels.length > 20) {
        labels.shift();
        chartData.datasets[0].data.shift();
      }
      balanceChart.update();

      // Tarixga qo‚Äòshish
      balanceHistory.unshift(`${timeLabel} ‚Äî $${balance.toFixed(2)}`);
      if (balanceHistory.length > 10) balanceHistory.pop();

      document.getElementById("history").innerHTML =
        balanceHistory.map(item => `<li>${item}</li>`).join('');
    }

    setInterval(update, 1000);
  </script>
</body>
</html>
